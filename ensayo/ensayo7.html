<!doctype html>
<html lang="es">
<head>
<!-- Favicon – Ensayo -->
<link rel="icon" type="image/png" href="../images/ensayo.png" sizes="any">
<link rel="shortcut icon" href="../images/ensayo.png">
<link rel="apple-touch-icon" href="../images/ensayo.png">

<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<!-- Android / Desktop: color de la barra del navegador -->
<meta name="theme-color" content="#2c2a89">  <!-- poné #000000 en páginas negras como menu.html -->

<!-- iOS PWA: usa el fondo de la página y pone iconos blancos -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">


  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ensayo — Paso 7</title>
  <link rel="stylesheet" href="../css/app.css?v=6">
  <style>
    /* Estilos locales para la lista de switches */
    .switch-list{ display:grid; gap:12px; margin-top:14px; }
    .switch-row{
      display:grid; grid-template-columns:1fr auto; align-items:center;
      padding:12px 8px; border-bottom:1px solid rgba(255,255,255,.12);
    }
    .switch-name{ color:#fff; font-size:1.05rem; }
    .switch{
      position:relative; width:52px; height:30px;
    }
    .switch input{
      position:absolute; inset:0; width:100%; height:100%;
      opacity:0; margin:0; cursor:pointer;
    }
    .switch .slider{
      position:absolute; inset:0; background:rgba(255,255,255,.25);
      border-radius:999px; transition:background .18s ease, box-shadow .18s ease;
    }
    .switch .slider::after{
      content:""; position:absolute; top:3px; left:3px;
      width:24px; height:24px; border-radius:50%; background:#fff;
      transition:transform .18s ease;
    }
    .switch input:checked + .slider{
      background:#4CAF50; /* verde del botón de tu paso 5 */
      box-shadow:0 0 0 3px rgba(76,175,80,.2) inset;
    }
    .switch input:checked + .slider::after{ transform:translateX(22px); }
  </style>
</head>
<body class="page-ensayo1">
  <main>
    <div class="ensayo-wrap">
      <h1 class="ensayo-title">¿Quién tomó alcohol?</h1>

      <form id="form7" class="ensayo-form" novalidate>
        <div id="lista" class="switch-list"></div>

        <div class="ensayo-actions">
          <button class="btn btn-primary" type="submit">Calcular total →</button>
        </div>
      </form>
    </div>
  </main>

  <script src="../js/nav-transitions.js?v=3"></script>
  <script>
    (function(){
      const KEY = 'ensayo_state';

      function getState(){ try { return JSON.parse(sessionStorage.getItem(KEY) || '{}'); } catch { return {}; } }
      function setState(s){ sessionStorage.setItem(KEY, JSON.stringify(s)); }

      const s = getState();

      // Nombres de integrantes; si faltan, intentamos armar por cantidad; si no hay nada, volvemos al paso 3
      let nombres = Array.isArray(s.integrantes) ? s.integrantes.slice() : [];
      if (!nombres.length && Number.isFinite(+s.cantidad) && +s.cantidad > 0) {
        const n = +s.cantidad;
        nombres = Array.from({length:n}, (_,i)=>`Integrante ${i+1}`);
      }
      if (!nombres.length) {
        if (window.startPageLeave) startPageLeave('ensayo3.html'); else location.href = 'ensayo3.html';
        return;
      }

      // Render de switches
      const cont = document.getElementById('lista');
      const inputs = [];
      nombres.forEach((name, idx) => {
        const row = document.createElement('div');
        row.className = 'switch-row';

        const label = document.createElement('div');
        label.className = 'switch-name';
        label.textContent = name;

        const sw = document.createElement('label');
        sw.className = 'switch';
        sw.innerHTML = '<input type="checkbox" aria-label="Tomó alcohol"><span class="slider"></span>';

        row.appendChild(label);
        row.appendChild(sw);
        cont.appendChild(row);

        inputs.push(sw.querySelector('input'));
      });

      // Preseleccionar si ya había tomadores guardados
      if (Array.isArray(s.quienesTomaronIdx)) {
        s.quienesTomaronIdx.forEach(i => { if (inputs[i]) inputs[i].checked = true; });
      } else if (Array.isArray(s.quienesTomaronNombres)) {
        inputs.forEach((inp, i) => { if (s.quienesTomaronNombres.includes(nombres[i])) inp.checked = true; });
      }

      // Submit → validar al menos uno, guardar y avanzar
      const form = document.getElementById('form7');
      form.addEventListener('submit', (ev) => {
        ev.preventDefault();
        const idxs = [];
        const noms = [];
        inputs.forEach((inp, i) => { if (inp.checked) { idxs.push(i); noms.push(nombres[i]); } });

        if (!idxs.length) { alert('Debe haber al menos una persona que tomó alcohol.'); return; }

        const nextState = {
          ...s,
          quienesTomaronIdx: idxs,
          quienesTomaronNombres: noms
        };
        setState(nextState);

        if (window.startPageLeave) startPageLeave('ensayo8.html');
        else location.href = 'ensayo8.html';
      });
    })();
  </script>
</body>
</html>
