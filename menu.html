<!doctype html>
<html lang="es">
<head>
  <!-- Codificaci√≥n y viewport -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- Color de la barra del navegador (Android/desktop) -->
  <meta name="theme-color" content="#000000" />

  <!-- Manifest PWA -->
  <link rel="manifest" href="/manifest.webmanifest">

  <!-- √çconos del sitio / PWA -->
  <link rel="icon" href="images/menu.png" sizes="any">
  <link rel="apple-touch-icon" sizes="192x192" href="./images/logo-cuadrado-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="./images/logo-cuadrado-512.png">

  <!-- Metadatos sociales (Open Graph / WhatsApp / Twitter) -->
  <meta property="og:title" content="Nadie quiere pensar ‚Äî Calculadora para ensayos, juntadas y canchitas">
  <meta property="og:description" content="Sac√° la cuenta por persona en 3 minutos.">
  <meta property="og:image" content="https://nadiequierepensar.github.io/images/og-card.png">
  <meta property="og:url" content="https://nadiequierepensar.github.io/">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">

  <!-- T√≠tulo y estilos (preload + hoja) -->
  <title>Nadie quiere pensar</title>
  <link rel="preload" href="css/app.css?v=4" as="style">
  <link rel="stylesheet" href="css/app.css?v=4">

  <!-- üëá Snippet m√≠nimo: detectar app instalada y forzar index en iOS -->
  <script>
    (function(){
      var isStandalone = (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches)
                         || window.navigator.standalone === true;
      var isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent || '');

      // Clase para poder aplicar estilos cuando est√° instalada
      if (isStandalone) { document.documentElement.classList.add('app-installed'); }

      // En iOS instalada, si por alguna raz√≥n abre /menu.html ‚Üí ir a /index.html
      if (isStandalone && isIOS) {
        var p = (location.pathname || '').toLowerCase();
        if (p.endsWith('/menu.html')) location.replace('/index.html');
      }
    })();
  </script>
</head>
<body>
  <main>
    <!-- Encabezado principal -->
    <div class="container">
      <h1>Nadie quiere pensar</h1>

      <!-- Lista de opciones del men√∫ -->
      <section class="list">
        <!-- Fila 1: Ensayo -->
        <div class="row">
          <div class="row-title">En el ensayo</div>
          <a class="row-btn" aria-label="Calcular ensayo" href="ensayo/ensayo1.html">
            <img src="images/ensayo.png" alt="Ensayo">
          </a>
        </div>

        <!-- Fila 2: Juntada -->
        <div class="row">
          <div class="row-title">En la juntada</div>
          <a class="row-btn" aria-label="Calcular juntada" href="juntadas/juntadas1.html">
            <img src="images/juntada.png" alt="Juntada">
          </a>
        </div>

        <!-- Fila 3: Canchita -->
        <div class="row">
          <div class="row-title">En la canchita</div>
          <a class="row-btn" aria-label="Calcular canchita" href="canchita/canchita1.html">
            <img src="images/canchita.png" alt="Canchita">
          </a>
        </div>
      </section>
    </div>

    <!-- Bot√≥n inferior con easter egg -->
    <div class="footer">
      <button class="cta" onclick="alert('Como todas las buenas ideas, ‚ÄúNadie quiere pensar‚Äù surge de la venganza, la venganza contra el constante encaje de cuentas/plata por parte de mis amigos: ‚Äú¬øCu√°nto es mi parte?‚Äù, ‚Äú¬°Yo no tom√© alcohol eh!‚Äù, ‚ÄúLa otra vez yo puse de m√°s y me quedaron debiendo‚Äù. Bueno, todo eso se acab√≥. Tomen, calc√∫lenlo ustedes ahora, les hice una aplicaci√≥n para eso.')">CharlyCorp¬Æ</button>
    </div>
  </main>

  <!-- Scripts base (transiciones + SW) -->
  <script src="js/nav-transitions.js?v=1"></script>
  <script>
    // Registrar Service Worker (si el navegador lo soporta)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js');
    }
  </script>

  <!-- Barra inferior ‚ÄúInstalar app‚Äù (oculta por defecto) -->
  <div id="install-wrap" style="position:fixed;left:0;right:0;bottom:84px;display:none;justify-content:center;z-index:9999">
    <button id="btn-install" class="cta">Instalar app</button>
  </div>

  <!-- L√≥gica de instalaci√≥n (Android/iOS) -->
  <script>
    let deferredPrompt = null;

    // Android/Chrome: capturar evento y mostrar la barra
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('install-wrap').style.display = 'flex';
    });

    // Click en ‚ÄúInstalar‚Äù
    document.getElementById('btn-install').addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
      document.getElementById('install-wrap').style.display = 'none';
    });

    // iOS: no hay evento. Mostramos un tip para ‚ÄúAgregar a inicio‚Äù
    const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || navigator.standalone;
    if (isIOS && !isStandalone && !sessionStorage.getItem('a2hs_tip')) {
      const tip = document.createElement('div');
      tip.style.cssText = "position:fixed;left:8px;right:8px;bottom:84px;background:#141414;color:#fff;padding:12px 14px;border-radius:12px;text-align:center;opacity:.95;z-index:9999";
      tip.textContent = 'Para instalar: Compartir ‚Üí ‚ÄúAgregar a pantalla de inicio‚Äù.';
      document.body.appendChild(tip);
      sessionStorage.setItem('a2hs_tip', '1');
      setTimeout(() => tip.remove(), 7000);
    }
  </script>

  <!-- Reset de estado (atajos + long-press + URL) -->
  <script>
  /* ============================
     Reset de estado (Canchita/Juntadas/Ensayo)
     - URL: menu.html?reset=1
     - Teclado: Ctrl/Cmd + Alt + R
     - Long-press (800ms) sobre el bot√≥n .cta (CharlyCorp¬Æ)
     - Consola: window.resetAppState()
     ============================ */
  (function(){
    // Claves expl√≠citas + patr√≥n por si aparece otra variante (_state o _state_vN)
    const EXPLICIT_KEYS = ['canchita_state_v1', 'ensayo_state', 'juntadas_state'];

    function clearStates(){
      try{
        const toRemove = new Set(EXPLICIT_KEYS);
        for (let i = 0; i < sessionStorage.length; i++){
          const k = sessionStorage.key(i);
          if (/_state($|_v\d+$)/.test(k)) toRemove.add(k);
        }
        toRemove.forEach(k => sessionStorage.removeItem(k));
      }catch(e){ console.warn('No se pudo limpiar sessionStorage', e); }
    }

    function resetAndNotify(){
      clearStates();
      alert('Se reiniciaron los datos temporales de la app.');
    }

    // 1) URL ?reset=1
    if (new URLSearchParams(location.search).has('reset')){
      resetAndNotify();
      // quitar el par√°metro sin recargar
      const url = new URL(location.href);
      url.searchParams.delete('reset');
      history.replaceState({}, '', url.pathname + (url.search ? '?' + url.searchParams.toString() : '') + url.hash);
    }

    // 2) Atajo de teclado: Ctrl/Cmd + Alt + R
    window.addEventListener('keydown', (e) => {
      const isR = (e.key || '').toLowerCase() === 'r';
      if (isR && e.altKey && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        resetAndNotify();
      }
    });

    // 3) Long-press (800ms) sobre el bot√≥n CharlyCorp¬Æ (.cta)
    (function attachLongPress(){
      const cta = document.querySelector('.cta');
      if (!cta) return;
      let timer = null, fired = false;
      const start = (ev) => {
        fired = false;
        timer = setTimeout(() => { fired = true; resetAndNotify(); }, 800);
      };
      const end = (ev) => {
        clearTimeout(timer);
        if (fired) {
          // evitar que dispare el onclick original si el reset ya ocurri√≥
          ev.preventDefault();
          ev.stopPropagation();
        }
      };
      cta.addEventListener('touchstart', start, {passive:true});
      cta.addEventListener('touchend', end);
      cta.addEventListener('mousedown', start);
      cta.addEventListener('mouseup', end);
      cta.addEventListener('click', (ev) => { if (fired) { ev.preventDefault(); ev.stopImmediatePropagation(); } }, true);
    })();

    // 4) Consola
    window.resetAppState = resetAndNotify;
  })();
  </script>
</body>
</html>
