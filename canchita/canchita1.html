<!doctype html>
<html lang="es">
<head>
  <!-- Favicon – Canchita -->
  <link rel="icon" type="image/png" href="../images/canchita.png" sizes="any">
  <link rel="shortcut icon" href="../images/canchita.png">
  <link rel="apple-touch-icon" href="../images/canchita.png">

  <!-- Meta base -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- Android / Desktop: color de la barra del navegador (tema Canchita) -->
  <meta name="theme-color" content="#2a892e">

  <!-- iOS PWA: pantalla completa + status bar translúcida -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Título y estilos -->
  <title>Canchita — Paso 1</title>
  <link rel="stylesheet" href="../css/app.css?v=6">
</head>
<body class="page-canchita">
  <main>
    <!-- Contenedor principal -->
    <div class="canchita-wrap">
      <h1 id="saludo" class="canchita-title">¡Hola equipo! ¿Cuántos son?</h1>

      <!-- Formulario: elegir cantidad de jugadores -->
      <form id="form1" class="canchita-form" novalidate>
        <!-- Selector estilizado -->
        <select id="jugadores" class="canchita-select" aria-label="Cantidad de jugadores" required>
          <option value="" selected disabled>Seleccioná una opción...</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
        </select>

        <!-- Acciones -->
        <div class="canchita-actions">
          <!-- Oculto por defecto: se muestra si ya hay valor (ej. al volver con “Atrás”) -->
          <button class="btn btn-primary" id="next" type="submit" hidden>Siguiente →</button>
        </div>
      </form>
    </div>
  </main>

  <!-- Scripts: transiciones y lógica de paso -->
  <script src="../js/nav-transitions.js?v=3"></script>
  <script>
    (function(){
      const KEY  = 'canchita_state_v1'; // estado específico de Canchita
      const NEXT = 'canchita2.html';

      const form = document.getElementById('form1');
      const sel  = document.getElementById('jugadores');
      const btn  = document.getElementById('next');

      function showNextIfSelected(){
        btn.hidden = !sel.value; // muestra el botón si hay una opción elegida
      }

      function saveAndGo(){
        const val = parseInt(sel.value, 10);
        if (!Number.isFinite(val) || val < 1) {
          alert('No elegiste nada pancho');
          sel.focus();
          return;
        }

        // Guardar en sessionStorage y avanzar
        let state = {};
        try { state = JSON.parse(sessionStorage.getItem(KEY) || '{}'); } catch {}
        state.cantidad = val;
        sessionStorage.setItem(KEY, JSON.stringify(state));

        if (window.startPageLeave) startPageLeave(NEXT);
        else location.href = NEXT;
      }

      // 1) Selección nueva → avanzar automáticamente
      sel.addEventListener('change', saveAndGo);

      // 2) Botón/Enter → avanzar si ya hay valor (ej: al volver con “Atrás”)
      form.addEventListener('submit', (e) => { e.preventDefault(); saveAndGo(); });
      sel.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && sel.value) { e.preventDefault(); saveAndGo(); }
      });

      // 3) Al cargar o volver desde el historial, reflejar estado y mostrar botón si corresponde
      (function hydrateFromState(){
        let state = {};
        try { state = JSON.parse(sessionStorage.getItem(KEY) || '{}'); } catch {}
        if (state.cantidad && !sel.value) {
          // si hay valor guardado y el select está “vacío”, lo seteamos
          const v = String(state.cantidad);
          if ([...sel.options].some(o => o.value === v)) sel.value = v;
        }
      })();

      showNextIfSelected();                        // primera carga
      window.addEventListener('pageshow', showNextIfSelected); // bfcache (volver/avanzar)
    })();
  </script>
</body>
</html>
