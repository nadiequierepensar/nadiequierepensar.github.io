<!doctype html>
<html lang="es">
<head>
<!-- Favicon – Canchita -->
<link rel="icon" type="image/png" href="../images/canchita.png" sizes="any">
<link rel="shortcut icon" href="../images/canchita.png">
<link rel="apple-touch-icon" href="../images/canchita.png">
  <!-- Meta base -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- Android / Desktop: color de la barra del navegador -->
  <meta name="theme-color" content="#2a892e"> <!-- poné #000000 en páginas negras como menu.html -->

  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Título y estilos -->
  <title>Canchita — Paso 8</title>
  <link rel="stylesheet" href="../css/app.css?v=6">
  <style>
    /* Estilos locales (tema verde) */
    .money{ display:flex; align-items:center; gap:8px; margin-top:12px; }
    .peso{ color:#fff; font-size:1.5rem; padding-right:8px; line-height:1; }
    .money-input{ height:50px; } /* como en tu XML */
  </style>
</head>
<body class="page-canchita">
  <main>
    <!-- Contenedor principal -->
    <div class="canchita-wrap">
      <h1 class="canchita-title">¿Cuánto salió el 3° tiempo?</h1>

      <!-- Formulario: ingreso del monto del 3° tiempo -->
      <form id="form8" class="canchita-form" novalidate>
        <div class="money">
          <span class="peso">$</span>
          <input
            id="montoAlcohol"
            class="canchita-input money-input"
            type="text"
            inputmode="numeric"
            pattern="[0-9]*"
            maxlength="6"
            placeholder="Ingrese el monto"
            autocomplete="off"
            enterkeyhint="done"
            autofocus
          />
        </div>

        <!-- Acciones -->
        <div class="canchita-actions">
          <button id="next" class="btn btn-primary" type="submit" style="display:none">
            Siguiente →
          </button>
        </div>
      </form>
    </div>
  </main>

  <!-- Scripts: transiciones y lógica -->
  <script src="../js/nav-transitions.js?v=3"></script>
  <script>
    (function(){
      const KEY   = 'canchita_state_v1';
      const NEXT  = 'canchita9.html';    // quiénes jugaron el 3° tiempo
      const SKIP  = 'canchita10.html';   // resultado (si en C7 dijeron que no hubo)

      const form  = document.getElementById('form8');
      const input = document.getElementById('montoAlcohol');
      const next  = document.getElementById('next');

      // Guard: si en el paso 7 marcaron que NO hubo 3° tiempo, saltar al resultado
      try {
        const s = JSON.parse(sessionStorage.getItem(KEY) || '{}');
        if (s.tercer_tiempo && s.tercer_tiempo.hubo === false) {
          if (window.startPageLeave) startPageLeave(SKIP, true); else location.href = SKIP;
          return;
        }
        // Prefill si ya había valor
        if (s.tercer_tiempo && Number.isFinite(s.tercer_tiempo.precio)) {
          input.value = String(s.tercer_tiempo.precio);
        }
      } catch {}

      // Sanitizar: solo dígitos (máx 6) y mostrar/ocultar botón
      function sanitize(){
        const digits = (input.value || '').replace(/\D+/g, '').slice(0, 6);
        if (digits !== input.value) input.value = digits;
        toggleNext();
      }
      function isValid(){
        const n = Number(input.value);
        return Number.isFinite(n) && n >= 1 && n <= 999999;
      }
      function toggleNext(){ next.style.display = isValid() ? 'inline-block' : 'none'; }

      input.addEventListener('input', sanitize);
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); form.requestSubmit(); }});
      sanitize(); // estado inicial

      // Submit → guardar y avanzar
      form.addEventListener('submit', (ev)=>{
        ev.preventDefault();
        if (!isValid()){ input.focus(); return; }
        const n = Number(input.value);

        let s={}; try{ s = JSON.parse(sessionStorage.getItem(KEY) || '{}'); }catch{}
        s.tercer_tiempo = Object.assign({ hubo:true }, s.tercer_tiempo, { precio: n });
        sessionStorage.setItem(KEY, JSON.stringify(s));

        if (window.startPageLeave) startPageLeave(NEXT);
        else location.href = NEXT;
      });
    })();
  </script>
</body>
</html>
